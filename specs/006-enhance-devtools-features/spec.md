# 功能规范: 增强与修复 DevTools 功能

**功能分支**: `006-enhance-devtools-features`
**创建日期**: 2025年11月27日
**状态**: 草稿
**输入**: 用户描述: "主题切换还是没有生效... 时间线没有渲染出来... 调度器状态未更新... 详情列表加时分秒... 支持拖拽宽高... 支持国际化(默认英文, json/js文件, 无额外包)..."

## 澄清事项

### 2025-11-27
- Q: 如何实现国际化以满足“轻量级，无外部依赖，使用 JSON/JS 文件”的要求？ -> A: 选项 A - 最小化的内存实现：直接在代码库中定义 `translations` 对象（例如 `en.ts`, `zh.ts`）。提供一个辅助函数 `t(key)` 用于查找当前语言。简单、同步、零依赖。

## 用户场景与测试 *(必填)*

### 用户故事 1 - 修复主题切换与样式一致性 (优先级: P1)

作为一名开发者，我希望在切换深色/浅色模式时，DevTools 的所有组件（列表、详情、时间线）都能正确应用新的颜色主题，以保证视觉体验的一致性。

**为何此优先级**: 现有功能失效，严重影响用户体验。

**独立测试**: 打开 DevTools，切换主题，检查所有子组件（特别是 Shadow DOM 内部）的背景色和文字颜色。

**验收场景**:

1. **鉴于** 当前为浅色主题，**当** 我切换到深色主题，**则** 任务列表、详情面板和时间线组件的背景色应变为深色，文字变为浅色。
2. **鉴于** 处于深色主题，**当** 我刷新页面，**则** 主题设置应保持（如果已持久化）或重置为默认，且样式渲染无闪烁。

---

### 用户故事 2 - 修复时间线渲染 Bug (优先级: P1)

作为一名开发者，我希望能够看到正确渲染的任务执行时间线，以便分析任务的历史执行情况。

**为何此优先级**: 核心功能缺失（Bug）。

**独立测试**: 运行任务并切换到时间线视图，确认画布上有绘制内容。

**验收场景**:

1. **鉴于** 任务正在运行，**当** 我进入时间线视图，**则** 画布上应显示代表任务执行的时间条或点。
2. **鉴于** 缩放滑块被拖动，**当** 我调整缩放级别，**则** 时间轴的时间刻度和任务条宽度应相应更新。

---

### 用户故事 3 - 修复调度器状态同步 (优先级: P1)

作为一名开发者，我希望 DevTools 能实时反映调度器的真实状态（如 idle, running, stopped），并且操作按钮（启动/暂停）能真正改变任务状态。

**为何此优先级**: 数据不一致会导致误导，丧失调试工具的价值。

**独立测试**: 点击“暂停”按钮，观察任务状态是否变更，并检查日志确认任务是否真的停止执行。

**验收场景**:

1. **鉴于** 任务正在运行，**当** 我点击“暂停”，**则** UI 状态应立即变为 "Paused"，且后续不应再有新的执行记录产生。
2. **鉴于** 任务处于 "Paused" 或 "Idle" 状态，**当** 我点击“启动/恢复”，**则** 任务应恢复执行，状态变为 "Running"。

---

### 用户故事 4 - 增强详情显示与可读性 (优先级: P2)

作为一名开发者，我希望在任务详情列表中看到精确到时分秒的触发时间，以便更精确地排查时序问题。

**为何此优先级**: 提升信息密度和实用性。

**独立测试**: 进入任务详情页，检查“Last Run”或历史记录列表中的时间格式。

**验收场景**:

1. **鉴于** 查看任务详情历史，**当** 我观察“Start Time”列，**则** 时间应显示为 `HH:mm:ss.SSS` 格式（或类似包含秒和毫秒的格式）。

---

### 用户故事 5 - 支持面板尺寸拖拽调节 (优先级: P2)

作为一名开发者，我希望在侧边停靠时能拖拽调整宽度，在底部停靠时能拖拽调整高度，以便在查看大量数据时获得更大的视野。

**为何此优先级**: 提升布局灵活性，模仿 Chrome DevTools 体验。

**独立测试**: 将鼠标移动到面板边缘，尝试拖动并观察面板尺寸变化。

**验收场景**:

1. **鉴于** 面板停靠在右侧，**当** 我拖动面板左边缘，**则** 面板宽度应随之改变。
2. **鉴于** 面板停靠在底部，**当** 我拖动面板上边缘，**则** 面板高度应随之改变。

---

### 用户故事 6 - 支持轻量级国际化 (i18n) (优先级: P2)

作为一名开发者，我希望 DevTools 支持多语言（默认英文），以便不同语言环境的用户使用。实现需轻量，不引入额外依赖。

**为何此优先级**: 产品化需求，扩大适用范围。

**独立测试**: 修改配置语言（或模拟环境），检查界面文本是否切换。

**验收场景**:

1. **鉴于** 默认配置，**当** 打开面板，**则** 所有文本应为英文。
2. **鉴于** 切换语言配置为中文（如果实现支持切换），**当** 界面刷新，**则** 关键标签（如 "Status", "Tasks", "Timeline"）应显示为中文。

## 需求 *(必填)*

### 功能需求

- **FR-001 (样式修复)**: 必须确保 CSS 变量（主题色）能够穿透或正确继承到所有 Shadow DOM 组件（List, Detail, Timeline）。
- **FR-002 (Timeline 修复)**: 必须修复 Canvas/SVG 的渲染逻辑，确保数据变化时重绘，且坐标计算正确。
- **FR-003 (状态同步)**: 必须修复 `TaskControlAPI` 与 `DevToolsStore` 的交互逻辑，确保 `pause/resume` 调用能正确触发 Scheduler 的状态变更并回传事件。
- **FR-004 (时间格式)**: 详情页和列表中的时间戳显示需精确到秒/毫秒。
- **FR-005 (拖拽调整)**: 实现一个拖拽手柄（Resizer Handle），根据 `dockPosition` 动态调整面板的 `width` 或 `height`。
- **FR-006 (国际化)**: 实现一个简单的 `I18n` 帮助类/函数，加载本地 JSON/JS 对象作为语言包。不引入第三方 i18n 库。默认提供 `en-US`，并支持最小化的内存实现，通过直接在代码库中定义 `translations` 对象（例如 `en.ts`, `zh.ts`）和 `t(key)` 辅助函数。

### 非功能性需求

- **NFR-001 (无依赖)**: 国际化和拖拽功能必须使用原生 JS/DOM API 实现。
- **NFR-002 (性能)**: 拖拽调整大小时，不应导致严重的布局抖动或帧率下降（可考虑 `requestAnimationFrame` 节流）。

### 关键实体

- **I18nStore/Service**: 管理当前语言和翻译字典。
- **ResizeState**: 记录当前面板的尺寸（宽/高）。

## 成功标准 *(必填)*

### 可衡量结果

- **SC-001**: 在深色模式下，界面无任何白色背景残留。
- **SC-002**: 点击暂停后，状态图标在 100ms 内更新，且后续日志停止增加。
- **SC-003**: 能够通过拖拽将面板宽度调整至屏幕宽度的 50% 以上。
- **SC-004**: 界面文本可通过加载不同的语言对象实现 100% 替换。